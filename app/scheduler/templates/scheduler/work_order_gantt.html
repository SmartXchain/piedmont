{% extends "base.html" %}
{% load static %}

{% block title %}Schedule – Work Order {{ work_order.id }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Schedule – Work Order {{ work_order.id }}</h2>
  <p>Part: {{ work_order.part }}</p>
  <p>Standard: {{ work_order.standard }} | Classification: {{ work_order.classification }}</p>

  <div id="gantt-target"></div>
</div>

<!-- Frappe Gantt (CDN example) -->
<script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css">

<script>
  document.addEventListener("DOMContentLoaded", function () {
    fetch("{% url 'scheduler:work_order_gantt_data' work_order.id %}")
      .then(response => response.json())
      .then(tasks => {
        // Map API fields to FrappeGantt format
        const ganttTasks = tasks.map(t => ({
          id: t.id,
          name: t.name,
          start: t.start,
          end: t.end,
          progress: t.progress,
          custom_class: t.status,  // you can style .planned, .in_progress, etc.
        }));

        const gantt = new Gantt("#gantt-target", ganttTasks, {
          view_mode: 'Day',
          date_format: 'YYYY-MM-DD HH:mm:ss',
          on_click: task => {
            console.log("Clicked task:", task);
          },
          on_date_change: (task, start, end) => {
            console.log("Rescheduled:", task, start, end);
            // later: send PATCH to update Operation.planned_start/planned_end
          },
        });
      });
  });
</script>
{% endblock %}

