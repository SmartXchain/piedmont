<div class="mb-3">
  <h5 class="mb-1">{{ template_obj.name }}</h5>
  <div class="text-muted" style="white-space:pre-wrap;">{{ template_obj.description }}</div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card border-success">
      <div class="card-body text-center">
        <div class="fw-bold fs-4">{{ performed_count }}</div>
        <div class="text-success">Performed (30 days)</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-warning">
      <div class="card-body text-center">
        <div class="fw-bold fs-4">{{ not_performed_count }}</div>
        <div class="text-warning">Not Performed (30 days)</div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card border-info">
      <div class="card-body">
        <div class="fw-semibold">Latest Completion</div>
        {% if latest_completed %}
          <div>Date: {{ latest_completed.scheduled_for }}</div>
          <div>Operator: {{ latest_completed.completed_by|default:"—" }}</div>
        {% else %}
          <div class="text-muted">No completions in the last 30 days.</div>
        {% endif %}
        <div class="mt-2 text-muted">
          Window: {{ start }} &rarr; {{ end }} ({{ total_days }} days)
        </div>
      </div>
    </div>
  </div>
</div>

<h6 class="mb-2">Daily Status (last 30 days)</h6>
<div class="table-responsive">
  <table class="table table-sm table-bordered table-striped align-middle">
    <thead class="table-light">
      <tr>
        <th style="width: 15%;">Date</th>
        <th style="width: 15%;">Status</th>
        <th style="width: 20%;">Result</th>
        <th>Operator</th>
        <th style="width: 22%;">Signed Off At</th>
        <th>Note</th>
      </tr>
    </thead>
    <tbody>
      {% for inst in instances %}
      <tr>
        <td>{{ inst.scheduled_for }}</td>
        <td>
          {% if inst.completed %}
            <span class="badge text-bg-success">Completed</span>
          {% else %}
            <span class="badge text-bg-warning">Not Completed</span>
          {% endif %}
        </td>
        <td>
          {% if inst.result == 'pass' %}
            <span class="badge text-bg-success">Pass</span>
          {% elif inst.result == 'fail' %}
            <span class="badge text-bg-danger">Fail</span>
          {% else %}—{% endif %}
        </td>
        <td>{{ inst.completed_by|default:"—" }}</td>
        <td>{{ inst.completed_at|date:"Y-m-d H:i"|default:"—" }}</td>
        <td style="white-space:pre-wrap;">{{ inst.note|default:"" }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center">No data for the last 30 days.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

